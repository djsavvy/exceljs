{"version":3,"file":"defined-name-xform.js","names":["BaseXform","require","colCache","DefinedNamesXform","render","xmlStream","model","openNode","name","localSheetId","writeText","ranges","join","closeNode","parseOpen","node","_parsedName","attributes","_parsedLocalSheetId","_parsedText","parseText","text","push","parseClose","extractRanges","undefined","parseInt","isValidRange","range","decodeEx","err","parsedText","quotesOpened","last","split","forEach","item","quotes","match","length","concat","quotesEven","module","exports"],"sources":["../../../../../lib/xlsx/xform/book/defined-name-xform.js"],"sourcesContent":["const BaseXform = require('../base-xform');\r\nconst colCache = require('../../../utils/col-cache');\r\n\r\nclass DefinedNamesXform extends BaseXform {\r\n  render(xmlStream, model) {\r\n    // <definedNames>\r\n    //   <definedName name=\"name\">name.ranges.join(',')</definedName>\r\n    //   <definedName name=\"_xlnm.Print_Area\" localSheetId=\"0\">name.ranges.join(',')</definedName>\r\n    // </definedNames>\r\n    xmlStream.openNode('definedName', {\r\n      name: model.name,\r\n      localSheetId: model.localSheetId,\r\n    });\r\n    xmlStream.writeText(model.ranges.join(','));\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    switch (node.name) {\r\n      case 'definedName':\r\n        this._parsedName = node.attributes.name;\r\n        this._parsedLocalSheetId = node.attributes.localSheetId;\r\n        this._parsedText = [];\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    this._parsedText.push(text);\r\n  }\r\n\r\n  parseClose() {\r\n    this.model = {\r\n      name: this._parsedName,\r\n      ranges: extractRanges(this._parsedText.join('')),\r\n    };\r\n    if (this._parsedLocalSheetId !== undefined) {\r\n      this.model.localSheetId = parseInt(this._parsedLocalSheetId, 10);\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction isValidRange(range) {\r\n  try {\r\n    colCache.decodeEx(range);\r\n    return true;\r\n  } catch (err) {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction extractRanges(parsedText) {\r\n  const ranges = [];\r\n  let quotesOpened = false;\r\n  let last = '';\r\n  parsedText.split(',').forEach(item => {\r\n    if (!item) {\r\n      return;\r\n    }\r\n    const quotes = (item.match(/'/g) || []).length;\r\n\r\n    if (!quotes) {\r\n      if (quotesOpened) {\r\n        last += `${item},`;\r\n      } else if (isValidRange(item)) {\r\n        ranges.push(item);\r\n      }\r\n      return;\r\n    }\r\n    const quotesEven = quotes % 2 === 0;\r\n\r\n    if (!quotesOpened && quotesEven && isValidRange(item)) {\r\n      ranges.push(item);\r\n    } else if (quotesOpened && !quotesEven) {\r\n      quotesOpened = false;\r\n      if (isValidRange(last + item)) {\r\n        ranges.push(last + item);\r\n      }\r\n      last = '';\r\n    } else {\r\n      quotesOpened = true;\r\n      last += `${item},`;\r\n    }\r\n  });\r\n  return ranges;\r\n}\r\n\r\nmodule.exports = DefinedNamesXform;\r\n"],"mappings":";;AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,eAAe,CAAC;AAC1C,MAAMC,QAAQ,GAAGD,OAAO,CAAC,0BAA0B,CAAC;AAEpD,MAAME,iBAAiB,SAASH,SAAS,CAAC;EACxCI,MAAMA,CAACC,SAAS,EAAEC,KAAK,EAAE;IACvB;IACA;IACA;IACA;IACAD,SAAS,CAACE,QAAQ,CAAC,aAAa,EAAE;MAChCC,IAAI,EAAEF,KAAK,CAACE,IAAI;MAChBC,YAAY,EAAEH,KAAK,CAACG;IACtB,CAAC,CAAC;IACFJ,SAAS,CAACK,SAAS,CAACJ,KAAK,CAACK,MAAM,CAACC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC3CP,SAAS,CAACQ,SAAS,CAAC,CAAC;EACvB;EAEAC,SAASA,CAACC,IAAI,EAAE;IACd,QAAQA,IAAI,CAACP,IAAI;MACf,KAAK,aAAa;QAChB,IAAI,CAACQ,WAAW,GAAGD,IAAI,CAACE,UAAU,CAACT,IAAI;QACvC,IAAI,CAACU,mBAAmB,GAAGH,IAAI,CAACE,UAAU,CAACR,YAAY;QACvD,IAAI,CAACU,WAAW,GAAG,EAAE;QACrB,OAAO,IAAI;MACb;QACE,OAAO,KAAK;IAChB;EACF;EAEAC,SAASA,CAACC,IAAI,EAAE;IACd,IAAI,CAACF,WAAW,CAACG,IAAI,CAACD,IAAI,CAAC;EAC7B;EAEAE,UAAUA,CAAA,EAAG;IACX,IAAI,CAACjB,KAAK,GAAG;MACXE,IAAI,EAAE,IAAI,CAACQ,WAAW;MACtBL,MAAM,EAAEa,aAAa,CAAC,IAAI,CAACL,WAAW,CAACP,IAAI,CAAC,EAAE,CAAC;IACjD,CAAC;IACD,IAAI,IAAI,CAACM,mBAAmB,KAAKO,SAAS,EAAE;MAC1C,IAAI,CAACnB,KAAK,CAACG,YAAY,GAAGiB,QAAQ,CAAC,IAAI,CAACR,mBAAmB,EAAE,EAAE,CAAC;IAClE;IACA,OAAO,KAAK;EACd;AACF;AAEA,SAASS,YAAYA,CAACC,KAAK,EAAE;EAC3B,IAAI;IACF1B,QAAQ,CAAC2B,QAAQ,CAACD,KAAK,CAAC;IACxB,OAAO,IAAI;EACb,CAAC,CAAC,OAAOE,GAAG,EAAE;IACZ,OAAO,KAAK;EACd;AACF;AAEA,SAASN,aAAaA,CAACO,UAAU,EAAE;EACjC,MAAMpB,MAAM,GAAG,EAAE;EACjB,IAAIqB,YAAY,GAAG,KAAK;EACxB,IAAIC,IAAI,GAAG,EAAE;EACbF,UAAU,CAACG,KAAK,CAAC,GAAG,CAAC,CAACC,OAAO,CAACC,IAAI,IAAI;IACpC,IAAI,CAACA,IAAI,EAAE;MACT;IACF;IACA,MAAMC,MAAM,GAAG,CAACD,IAAI,CAACE,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,EAAEC,MAAM;IAE9C,IAAI,CAACF,MAAM,EAAE;MACX,IAAIL,YAAY,EAAE;QAChBC,IAAI,OAAAO,MAAA,CAAOJ,IAAI,MAAG;MACpB,CAAC,MAAM,IAAIT,YAAY,CAACS,IAAI,CAAC,EAAE;QAC7BzB,MAAM,CAACW,IAAI,CAACc,IAAI,CAAC;MACnB;MACA;IACF;IACA,MAAMK,UAAU,GAAGJ,MAAM,GAAG,CAAC,KAAK,CAAC;IAEnC,IAAI,CAACL,YAAY,IAAIS,UAAU,IAAId,YAAY,CAACS,IAAI,CAAC,EAAE;MACrDzB,MAAM,CAACW,IAAI,CAACc,IAAI,CAAC;IACnB,CAAC,MAAM,IAAIJ,YAAY,IAAI,CAACS,UAAU,EAAE;MACtCT,YAAY,GAAG,KAAK;MACpB,IAAIL,YAAY,CAACM,IAAI,GAAGG,IAAI,CAAC,EAAE;QAC7BzB,MAAM,CAACW,IAAI,CAACW,IAAI,GAAGG,IAAI,CAAC;MAC1B;MACAH,IAAI,GAAG,EAAE;IACX,CAAC,MAAM;MACLD,YAAY,GAAG,IAAI;MACnBC,IAAI,OAAAO,MAAA,CAAOJ,IAAI,MAAG;IACpB;EACF,CAAC,CAAC;EACF,OAAOzB,MAAM;AACf;AAEA+B,MAAM,CAACC,OAAO,GAAGxC,iBAAiB","ignoreList":[]}