{"version":3,"file":"workbook-writer.js","names":["fs","require","Archiver","StreamBuf","RelType","StylesXform","SharedStrings","DefinedNames","CoreXform","RelationshipsXform","ContentTypesXform","AppXform","WorkbookXform","SharedStringsXform","WorksheetWriter","theme1Xml","WorkbookWriter","constructor","options","created","Date","modified","creator","lastModifiedBy","lastPrinted","useSharedStrings","sharedStrings","styles","useStyles","Mock","_definedNames","_worksheets","views","zipOptions","zip","media","commentRefs","stream","filename","createWriteStream","pipe","promise","Promise","all","addThemes","addOfficeRels","definedNames","_openStream","path","bufSize","batch","append","name","on","emit","_commitWorksheets","commitWorksheet","worksheet","committed","resolve","commit","promises","map","length","addMedia","addContentTypes","addApp","addCore","addSharedStrings","addStyles","addWorkbookRels","addWorkbook","_finalize","nextId","i","addImage","image","id","medium","Object","assign","type","concat","extension","push","getImage","addWorksheet","undefined","tabColor","console","trace","properties","workbook","state","pageSetup","autoFilter","headerFooter","getWorksheet","find","xml","xform","toXml","Id","Type","OfficeDocument","Target","CoreProperties","ExtenderProperties","model","worksheets","filter","Boolean","file","buffer","base64","dataimg64","content","substring","indexOf","Error","coreXform","count","sharedStringsXform","relationships","Styles","Theme","forEach","rId","Worksheet","calcProperties","prepare","reject","finalize","module","exports"],"sources":["../../../../lib/stream/xlsx/workbook-writer.js"],"sourcesContent":["const fs = require('fs');\r\nconst Archiver = require('archiver');\r\n\r\nconst StreamBuf = require('../../utils/stream-buf');\r\n\r\nconst RelType = require('../../xlsx/rel-type');\r\nconst StylesXform = require('../../xlsx/xform/style/styles-xform');\r\nconst SharedStrings = require('../../utils/shared-strings');\r\nconst DefinedNames = require('../../doc/defined-names');\r\n\r\nconst CoreXform = require('../../xlsx/xform/core/core-xform');\r\nconst RelationshipsXform = require('../../xlsx/xform/core/relationships-xform');\r\nconst ContentTypesXform = require('../../xlsx/xform/core/content-types-xform');\r\nconst AppXform = require('../../xlsx/xform/core/app-xform');\r\nconst WorkbookXform = require('../../xlsx/xform/book/workbook-xform');\r\nconst SharedStringsXform = require('../../xlsx/xform/strings/shared-strings-xform');\r\n\r\nconst WorksheetWriter = require('./worksheet-writer');\r\n\r\nconst theme1Xml = require('../../xlsx/xml/theme1.js');\r\n\r\nclass WorkbookWriter {\r\n  constructor(options) {\r\n    options = options || {};\r\n\r\n    this.created = options.created || new Date();\r\n    this.modified = options.modified || this.created;\r\n    this.creator = options.creator || 'ExcelJS';\r\n    this.lastModifiedBy = options.lastModifiedBy || 'ExcelJS';\r\n    this.lastPrinted = options.lastPrinted;\r\n\r\n    // using shared strings creates a smaller xlsx file but may use more memory\r\n    this.useSharedStrings = options.useSharedStrings || false;\r\n    this.sharedStrings = new SharedStrings();\r\n\r\n    // style manager\r\n    this.styles = options.useStyles ? new StylesXform(true) : new StylesXform.Mock(true);\r\n\r\n    // defined names\r\n    this._definedNames = new DefinedNames();\r\n\r\n    this._worksheets = [];\r\n    this.views = [];\r\n\r\n    this.zipOptions = options.zip;\r\n\r\n    this.media = [];\r\n    this.commentRefs = [];\r\n\r\n    this.zip = Archiver('zip', this.zipOptions);\r\n    if (options.stream) {\r\n      this.stream = options.stream;\r\n    } else if (options.filename) {\r\n      this.stream = fs.createWriteStream(options.filename);\r\n    } else {\r\n      this.stream = new StreamBuf();\r\n    }\r\n    this.zip.pipe(this.stream);\r\n\r\n    // these bits can be added right now\r\n    this.promise = Promise.all([this.addThemes(), this.addOfficeRels()]);\r\n  }\r\n\r\n  get definedNames() {\r\n    return this._definedNames;\r\n  }\r\n\r\n  _openStream(path) {\r\n    const stream = new StreamBuf({bufSize: 65536, batch: true});\r\n    this.zip.append(stream, {name: path});\r\n    stream.on('finish', () => {\r\n      stream.emit('zipped');\r\n    });\r\n    return stream;\r\n  }\r\n\r\n  _commitWorksheets() {\r\n    const commitWorksheet = function(worksheet) {\r\n      if (!worksheet.committed) {\r\n        return new Promise(resolve => {\r\n          worksheet.stream.on('zipped', () => {\r\n            resolve();\r\n          });\r\n          worksheet.commit();\r\n        });\r\n      }\r\n      return Promise.resolve();\r\n    };\r\n    // if there are any uncommitted worksheets, commit them now and wait\r\n    const promises = this._worksheets.map(commitWorksheet);\r\n    if (promises.length) {\r\n      return Promise.all(promises);\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  async commit() {\r\n    // commit all worksheets, then add suplimentary files\r\n    await this.promise;\r\n    await this.addMedia();\r\n    await this._commitWorksheets();\r\n    await Promise.all([\r\n      this.addContentTypes(),\r\n      this.addApp(),\r\n      this.addCore(),\r\n      this.addSharedStrings(),\r\n      this.addStyles(),\r\n      this.addWorkbookRels(),\r\n    ]);\r\n    await this.addWorkbook();\r\n    return this._finalize();\r\n  }\r\n\r\n  get nextId() {\r\n    // find the next unique spot to add worksheet\r\n    let i;\r\n    for (i = 1; i < this._worksheets.length; i++) {\r\n      if (!this._worksheets[i]) {\r\n        return i;\r\n      }\r\n    }\r\n    return this._worksheets.length || 1;\r\n  }\r\n\r\n  addImage(image) {\r\n    const id = this.media.length;\r\n    const medium = Object.assign({}, image, {type: 'image', name: `image${id}.${image.extension}`});\r\n    this.media.push(medium);\r\n    return id;\r\n  }\r\n\r\n  getImage(id) {\r\n    return this.media[id];\r\n  }\r\n\r\n  addWorksheet(name, options) {\r\n    // it's possible to add a worksheet with different than default\r\n    // shared string handling\r\n    // in fact, it's even possible to switch it mid-sheet\r\n    options = options || {};\r\n    const useSharedStrings =\r\n      options.useSharedStrings !== undefined ? options.useSharedStrings : this.useSharedStrings;\r\n\r\n    if (options.tabColor) {\r\n      // eslint-disable-next-line no-console\r\n      console.trace('tabColor option has moved to { properties: tabColor: {...} }');\r\n      options.properties = Object.assign(\r\n        {\r\n          tabColor: options.tabColor,\r\n        },\r\n        options.properties\r\n      );\r\n    }\r\n\r\n    const id = this.nextId;\r\n    name = name || `sheet${id}`;\r\n\r\n    const worksheet = new WorksheetWriter({\r\n      id,\r\n      name,\r\n      workbook: this,\r\n      useSharedStrings,\r\n      properties: options.properties,\r\n      state: options.state,\r\n      pageSetup: options.pageSetup,\r\n      views: options.views,\r\n      autoFilter: options.autoFilter,\r\n      headerFooter: options.headerFooter,\r\n    });\r\n\r\n    this._worksheets[id] = worksheet;\r\n    return worksheet;\r\n  }\r\n\r\n  getWorksheet(id) {\r\n    if (id === undefined) {\r\n      return this._worksheets.find(() => true);\r\n    }\r\n    if (typeof id === 'number') {\r\n      return this._worksheets[id];\r\n    }\r\n    if (typeof id === 'string') {\r\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  addStyles() {\r\n    return new Promise(resolve => {\r\n      this.zip.append(this.styles.xml, {name: 'xl/styles.xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addThemes() {\r\n    return new Promise(resolve => {\r\n      this.zip.append(theme1Xml, {name: 'xl/theme/theme1.xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addOfficeRels() {\r\n    return new Promise(resolve => {\r\n      const xform = new RelationshipsXform();\r\n      const xml = xform.toXml([\r\n        {Id: 'rId1', Type: RelType.OfficeDocument, Target: 'xl/workbook.xml'},\r\n        {Id: 'rId2', Type: RelType.CoreProperties, Target: 'docProps/core.xml'},\r\n        {Id: 'rId3', Type: RelType.ExtenderProperties, Target: 'docProps/app.xml'},\r\n      ]);\r\n      this.zip.append(xml, {name: '/_rels/.rels'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addContentTypes() {\r\n    return new Promise(resolve => {\r\n      const model = {\r\n        worksheets: this._worksheets.filter(Boolean),\r\n        sharedStrings: this.sharedStrings,\r\n        commentRefs: this.commentRefs,\r\n        media: this.media,\r\n      };\r\n      const xform = new ContentTypesXform();\r\n      const xml = xform.toXml(model);\r\n      this.zip.append(xml, {name: '[Content_Types].xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addMedia() {\r\n    return Promise.all(\r\n      this.media.map(medium => {\r\n        if (medium.type === 'image') {\r\n          const filename = `xl/media/${medium.name}`;\r\n          if (medium.filename) {\r\n            return this.zip.file(medium.filename, {name: filename});\r\n          }\r\n          if (medium.buffer) {\r\n            return this.zip.append(medium.buffer, {name: filename});\r\n          }\r\n          if (medium.base64) {\r\n            const dataimg64 = medium.base64;\r\n            const content = dataimg64.substring(dataimg64.indexOf(',') + 1);\r\n            return this.zip.append(content, {name: filename, base64: true});\r\n          }\r\n        }\r\n        throw new Error('Unsupported media');\r\n      })\r\n    );\r\n  }\r\n\r\n  addApp() {\r\n    return new Promise(resolve => {\r\n      const model = {\r\n        worksheets: this._worksheets.filter(Boolean),\r\n      };\r\n      const xform = new AppXform();\r\n      const xml = xform.toXml(model);\r\n      this.zip.append(xml, {name: 'docProps/app.xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addCore() {\r\n    return new Promise(resolve => {\r\n      const coreXform = new CoreXform();\r\n      const xml = coreXform.toXml(this);\r\n      this.zip.append(xml, {name: 'docProps/core.xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addSharedStrings() {\r\n    if (this.sharedStrings.count) {\r\n      return new Promise(resolve => {\r\n        const sharedStringsXform = new SharedStringsXform();\r\n        const xml = sharedStringsXform.toXml(this.sharedStrings);\r\n        this.zip.append(xml, {name: '/xl/sharedStrings.xml'});\r\n        resolve();\r\n      });\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  addWorkbookRels() {\r\n    let count = 1;\r\n    const relationships = [\r\n      {Id: `rId${count++}`, Type: RelType.Styles, Target: 'styles.xml'},\r\n      {Id: `rId${count++}`, Type: RelType.Theme, Target: 'theme/theme1.xml'},\r\n    ];\r\n    if (this.sharedStrings.count) {\r\n      relationships.push({\r\n        Id: `rId${count++}`,\r\n        Type: RelType.SharedStrings,\r\n        Target: 'sharedStrings.xml',\r\n      });\r\n    }\r\n    this._worksheets.forEach(worksheet => {\r\n      if (worksheet) {\r\n        worksheet.rId = `rId${count++}`;\r\n        relationships.push({\r\n          Id: worksheet.rId,\r\n          Type: RelType.Worksheet,\r\n          Target: `worksheets/sheet${worksheet.id}.xml`,\r\n        });\r\n      }\r\n    });\r\n    return new Promise(resolve => {\r\n      const xform = new RelationshipsXform();\r\n      const xml = xform.toXml(relationships);\r\n      this.zip.append(xml, {name: '/xl/_rels/workbook.xml.rels'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  addWorkbook() {\r\n    const {zip} = this;\r\n    const model = {\r\n      worksheets: this._worksheets.filter(Boolean),\r\n      definedNames: this._definedNames.model,\r\n      views: this.views,\r\n      properties: {},\r\n      calcProperties: {},\r\n    };\r\n\r\n    return new Promise(resolve => {\r\n      const xform = new WorkbookXform();\r\n      xform.prepare(model);\r\n      zip.append(xform.toXml(model), {name: '/xl/workbook.xml'});\r\n      resolve();\r\n    });\r\n  }\r\n\r\n  _finalize() {\r\n    return new Promise((resolve, reject) => {\r\n      this.stream.on('error', reject);\r\n      this.stream.on('finish', () => {\r\n        resolve(this);\r\n      });\r\n      this.zip.on('error', reject);\r\n\r\n      this.zip.finalize();\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = WorkbookWriter;\r\n"],"mappings":";;AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,MAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAME,SAAS,GAAGF,OAAO,CAAC,wBAAwB,CAAC;AAEnD,MAAMG,OAAO,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AAC9C,MAAMI,WAAW,GAAGJ,OAAO,CAAC,qCAAqC,CAAC;AAClE,MAAMK,aAAa,GAAGL,OAAO,CAAC,4BAA4B,CAAC;AAC3D,MAAMM,YAAY,GAAGN,OAAO,CAAC,yBAAyB,CAAC;AAEvD,MAAMO,SAAS,GAAGP,OAAO,CAAC,kCAAkC,CAAC;AAC7D,MAAMQ,kBAAkB,GAAGR,OAAO,CAAC,2CAA2C,CAAC;AAC/E,MAAMS,iBAAiB,GAAGT,OAAO,CAAC,2CAA2C,CAAC;AAC9E,MAAMU,QAAQ,GAAGV,OAAO,CAAC,iCAAiC,CAAC;AAC3D,MAAMW,aAAa,GAAGX,OAAO,CAAC,sCAAsC,CAAC;AACrE,MAAMY,kBAAkB,GAAGZ,OAAO,CAAC,+CAA+C,CAAC;AAEnF,MAAMa,eAAe,GAAGb,OAAO,CAAC,oBAAoB,CAAC;AAErD,MAAMc,SAAS,GAAGd,OAAO,CAAC,0BAA0B,CAAC;AAErD,MAAMe,cAAc,CAAC;EACnBC,WAAWA,CAACC,OAAO,EAAE;IACnBA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IAEvB,IAAI,CAACC,OAAO,GAAGD,OAAO,CAACC,OAAO,IAAI,IAAIC,IAAI,CAAC,CAAC;IAC5C,IAAI,CAACC,QAAQ,GAAGH,OAAO,CAACG,QAAQ,IAAI,IAAI,CAACF,OAAO;IAChD,IAAI,CAACG,OAAO,GAAGJ,OAAO,CAACI,OAAO,IAAI,SAAS;IAC3C,IAAI,CAACC,cAAc,GAAGL,OAAO,CAACK,cAAc,IAAI,SAAS;IACzD,IAAI,CAACC,WAAW,GAAGN,OAAO,CAACM,WAAW;;IAEtC;IACA,IAAI,CAACC,gBAAgB,GAAGP,OAAO,CAACO,gBAAgB,IAAI,KAAK;IACzD,IAAI,CAACC,aAAa,GAAG,IAAIpB,aAAa,CAAC,CAAC;;IAExC;IACA,IAAI,CAACqB,MAAM,GAAGT,OAAO,CAACU,SAAS,GAAG,IAAIvB,WAAW,CAAC,IAAI,CAAC,GAAG,IAAIA,WAAW,CAACwB,IAAI,CAAC,IAAI,CAAC;;IAEpF;IACA,IAAI,CAACC,aAAa,GAAG,IAAIvB,YAAY,CAAC,CAAC;IAEvC,IAAI,CAACwB,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,KAAK,GAAG,EAAE;IAEf,IAAI,CAACC,UAAU,GAAGf,OAAO,CAACgB,GAAG;IAE7B,IAAI,CAACC,KAAK,GAAG,EAAE;IACf,IAAI,CAACC,WAAW,GAAG,EAAE;IAErB,IAAI,CAACF,GAAG,GAAGhC,QAAQ,CAAC,KAAK,EAAE,IAAI,CAAC+B,UAAU,CAAC;IAC3C,IAAIf,OAAO,CAACmB,MAAM,EAAE;MAClB,IAAI,CAACA,MAAM,GAAGnB,OAAO,CAACmB,MAAM;IAC9B,CAAC,MAAM,IAAInB,OAAO,CAACoB,QAAQ,EAAE;MAC3B,IAAI,CAACD,MAAM,GAAGrC,EAAE,CAACuC,iBAAiB,CAACrB,OAAO,CAACoB,QAAQ,CAAC;IACtD,CAAC,MAAM;MACL,IAAI,CAACD,MAAM,GAAG,IAAIlC,SAAS,CAAC,CAAC;IAC/B;IACA,IAAI,CAAC+B,GAAG,CAACM,IAAI,CAAC,IAAI,CAACH,MAAM,CAAC;;IAE1B;IACA,IAAI,CAACI,OAAO,GAAGC,OAAO,CAACC,GAAG,CAAC,CAAC,IAAI,CAACC,SAAS,CAAC,CAAC,EAAE,IAAI,CAACC,aAAa,CAAC,CAAC,CAAC,CAAC;EACtE;EAEA,IAAIC,YAAYA,CAAA,EAAG;IACjB,OAAO,IAAI,CAAChB,aAAa;EAC3B;EAEAiB,WAAWA,CAACC,IAAI,EAAE;IAChB,MAAMX,MAAM,GAAG,IAAIlC,SAAS,CAAC;MAAC8C,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAAI,CAAC,CAAC;IAC3D,IAAI,CAAChB,GAAG,CAACiB,MAAM,CAACd,MAAM,EAAE;MAACe,IAAI,EAAEJ;IAAI,CAAC,CAAC;IACrCX,MAAM,CAACgB,EAAE,CAAC,QAAQ,EAAE,MAAM;MACxBhB,MAAM,CAACiB,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC,CAAC;IACF,OAAOjB,MAAM;EACf;EAEAkB,iBAAiBA,CAAA,EAAG;IAClB,MAAMC,eAAe,GAAG,SAAAA,CAASC,SAAS,EAAE;MAC1C,IAAI,CAACA,SAAS,CAACC,SAAS,EAAE;QACxB,OAAO,IAAIhB,OAAO,CAACiB,OAAO,IAAI;UAC5BF,SAAS,CAACpB,MAAM,CAACgB,EAAE,CAAC,QAAQ,EAAE,MAAM;YAClCM,OAAO,CAAC,CAAC;UACX,CAAC,CAAC;UACFF,SAAS,CAACG,MAAM,CAAC,CAAC;QACpB,CAAC,CAAC;MACJ;MACA,OAAOlB,OAAO,CAACiB,OAAO,CAAC,CAAC;IAC1B,CAAC;IACD;IACA,MAAME,QAAQ,GAAG,IAAI,CAAC9B,WAAW,CAAC+B,GAAG,CAACN,eAAe,CAAC;IACtD,IAAIK,QAAQ,CAACE,MAAM,EAAE;MACnB,OAAOrB,OAAO,CAACC,GAAG,CAACkB,QAAQ,CAAC;IAC9B;IACA,OAAOnB,OAAO,CAACiB,OAAO,CAAC,CAAC;EAC1B;EAEA,MAAMC,MAAMA,CAAA,EAAG;IACb;IACA,MAAM,IAAI,CAACnB,OAAO;IAClB,MAAM,IAAI,CAACuB,QAAQ,CAAC,CAAC;IACrB,MAAM,IAAI,CAACT,iBAAiB,CAAC,CAAC;IAC9B,MAAMb,OAAO,CAACC,GAAG,CAAC,CAChB,IAAI,CAACsB,eAAe,CAAC,CAAC,EACtB,IAAI,CAACC,MAAM,CAAC,CAAC,EACb,IAAI,CAACC,OAAO,CAAC,CAAC,EACd,IAAI,CAACC,gBAAgB,CAAC,CAAC,EACvB,IAAI,CAACC,SAAS,CAAC,CAAC,EAChB,IAAI,CAACC,eAAe,CAAC,CAAC,CACvB,CAAC;IACF,MAAM,IAAI,CAACC,WAAW,CAAC,CAAC;IACxB,OAAO,IAAI,CAACC,SAAS,CAAC,CAAC;EACzB;EAEA,IAAIC,MAAMA,CAAA,EAAG;IACX;IACA,IAAIC,CAAC;IACL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAAC3C,WAAW,CAACgC,MAAM,EAAEW,CAAC,EAAE,EAAE;MAC5C,IAAI,CAAC,IAAI,CAAC3C,WAAW,CAAC2C,CAAC,CAAC,EAAE;QACxB,OAAOA,CAAC;MACV;IACF;IACA,OAAO,IAAI,CAAC3C,WAAW,CAACgC,MAAM,IAAI,CAAC;EACrC;EAEAY,QAAQA,CAACC,KAAK,EAAE;IACd,MAAMC,EAAE,GAAG,IAAI,CAAC1C,KAAK,CAAC4B,MAAM;IAC5B,MAAMe,MAAM,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEJ,KAAK,EAAE;MAACK,IAAI,EAAE,OAAO;MAAE7B,IAAI,UAAA8B,MAAA,CAAUL,EAAE,OAAAK,MAAA,CAAIN,KAAK,CAACO,SAAS;IAAE,CAAC,CAAC;IAC/F,IAAI,CAAChD,KAAK,CAACiD,IAAI,CAACN,MAAM,CAAC;IACvB,OAAOD,EAAE;EACX;EAEAQ,QAAQA,CAACR,EAAE,EAAE;IACX,OAAO,IAAI,CAAC1C,KAAK,CAAC0C,EAAE,CAAC;EACvB;EAEAS,YAAYA,CAAClC,IAAI,EAAElC,OAAO,EAAE;IAC1B;IACA;IACA;IACAA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IACvB,MAAMO,gBAAgB,GACpBP,OAAO,CAACO,gBAAgB,KAAK8D,SAAS,GAAGrE,OAAO,CAACO,gBAAgB,GAAG,IAAI,CAACA,gBAAgB;IAE3F,IAAIP,OAAO,CAACsE,QAAQ,EAAE;MACpB;MACAC,OAAO,CAACC,KAAK,CAAC,8DAA8D,CAAC;MAC7ExE,OAAO,CAACyE,UAAU,GAAGZ,MAAM,CAACC,MAAM,CAChC;QACEQ,QAAQ,EAAEtE,OAAO,CAACsE;MACpB,CAAC,EACDtE,OAAO,CAACyE,UACV,CAAC;IACH;IAEA,MAAMd,EAAE,GAAG,IAAI,CAACJ,MAAM;IACtBrB,IAAI,GAAGA,IAAI,YAAA8B,MAAA,CAAYL,EAAE,CAAE;IAE3B,MAAMpB,SAAS,GAAG,IAAI3C,eAAe,CAAC;MACpC+D,EAAE;MACFzB,IAAI;MACJwC,QAAQ,EAAE,IAAI;MACdnE,gBAAgB;MAChBkE,UAAU,EAAEzE,OAAO,CAACyE,UAAU;MAC9BE,KAAK,EAAE3E,OAAO,CAAC2E,KAAK;MACpBC,SAAS,EAAE5E,OAAO,CAAC4E,SAAS;MAC5B9D,KAAK,EAAEd,OAAO,CAACc,KAAK;MACpB+D,UAAU,EAAE7E,OAAO,CAAC6E,UAAU;MAC9BC,YAAY,EAAE9E,OAAO,CAAC8E;IACxB,CAAC,CAAC;IAEF,IAAI,CAACjE,WAAW,CAAC8C,EAAE,CAAC,GAAGpB,SAAS;IAChC,OAAOA,SAAS;EAClB;EAEAwC,YAAYA,CAACpB,EAAE,EAAE;IACf,IAAIA,EAAE,KAAKU,SAAS,EAAE;MACpB,OAAO,IAAI,CAACxD,WAAW,CAACmE,IAAI,CAAC,MAAM,IAAI,CAAC;IAC1C;IACA,IAAI,OAAOrB,EAAE,KAAK,QAAQ,EAAE;MAC1B,OAAO,IAAI,CAAC9C,WAAW,CAAC8C,EAAE,CAAC;IAC7B;IACA,IAAI,OAAOA,EAAE,KAAK,QAAQ,EAAE;MAC1B,OAAO,IAAI,CAAC9C,WAAW,CAACmE,IAAI,CAACzC,SAAS,IAAIA,SAAS,IAAIA,SAAS,CAACL,IAAI,KAAKyB,EAAE,CAAC;IAC/E;IACA,OAAOU,SAAS;EAClB;EAEAlB,SAASA,CAAA,EAAG;IACV,OAAO,IAAI3B,OAAO,CAACiB,OAAO,IAAI;MAC5B,IAAI,CAACzB,GAAG,CAACiB,MAAM,CAAC,IAAI,CAACxB,MAAM,CAACwE,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAAe,CAAC,CAAC;MACzDO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAf,SAASA,CAAA,EAAG;IACV,OAAO,IAAIF,OAAO,CAACiB,OAAO,IAAI;MAC5B,IAAI,CAACzB,GAAG,CAACiB,MAAM,CAACpC,SAAS,EAAE;QAACqC,IAAI,EAAE;MAAqB,CAAC,CAAC;MACzDO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAd,aAAaA,CAAA,EAAG;IACd,OAAO,IAAIH,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAMyC,KAAK,GAAG,IAAI3F,kBAAkB,CAAC,CAAC;MACtC,MAAM0F,GAAG,GAAGC,KAAK,CAACC,KAAK,CAAC,CACtB;QAACC,EAAE,EAAE,MAAM;QAAEC,IAAI,EAAEnG,OAAO,CAACoG,cAAc;QAAEC,MAAM,EAAE;MAAiB,CAAC,EACrE;QAACH,EAAE,EAAE,MAAM;QAAEC,IAAI,EAAEnG,OAAO,CAACsG,cAAc;QAAED,MAAM,EAAE;MAAmB,CAAC,EACvE;QAACH,EAAE,EAAE,MAAM;QAAEC,IAAI,EAAEnG,OAAO,CAACuG,kBAAkB;QAAEF,MAAM,EAAE;MAAkB,CAAC,CAC3E,CAAC;MACF,IAAI,CAACvE,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAAc,CAAC,CAAC;MAC5CO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAM,eAAeA,CAAA,EAAG;IAChB,OAAO,IAAIvB,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAMiD,KAAK,GAAG;QACZC,UAAU,EAAE,IAAI,CAAC9E,WAAW,CAAC+E,MAAM,CAACC,OAAO,CAAC;QAC5CrF,aAAa,EAAE,IAAI,CAACA,aAAa;QACjCU,WAAW,EAAE,IAAI,CAACA,WAAW;QAC7BD,KAAK,EAAE,IAAI,CAACA;MACd,CAAC;MACD,MAAMiE,KAAK,GAAG,IAAI1F,iBAAiB,CAAC,CAAC;MACrC,MAAMyF,GAAG,GAAGC,KAAK,CAACC,KAAK,CAACO,KAAK,CAAC;MAC9B,IAAI,CAAC1E,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAAqB,CAAC,CAAC;MACnDO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAK,QAAQA,CAAA,EAAG;IACT,OAAOtB,OAAO,CAACC,GAAG,CAChB,IAAI,CAACR,KAAK,CAAC2B,GAAG,CAACgB,MAAM,IAAI;MACvB,IAAIA,MAAM,CAACG,IAAI,KAAK,OAAO,EAAE;QAC3B,MAAM3C,QAAQ,eAAA4C,MAAA,CAAeJ,MAAM,CAAC1B,IAAI,CAAE;QAC1C,IAAI0B,MAAM,CAACxC,QAAQ,EAAE;UACnB,OAAO,IAAI,CAACJ,GAAG,CAAC8E,IAAI,CAAClC,MAAM,CAACxC,QAAQ,EAAE;YAACc,IAAI,EAAEd;UAAQ,CAAC,CAAC;QACzD;QACA,IAAIwC,MAAM,CAACmC,MAAM,EAAE;UACjB,OAAO,IAAI,CAAC/E,GAAG,CAACiB,MAAM,CAAC2B,MAAM,CAACmC,MAAM,EAAE;YAAC7D,IAAI,EAAEd;UAAQ,CAAC,CAAC;QACzD;QACA,IAAIwC,MAAM,CAACoC,MAAM,EAAE;UACjB,MAAMC,SAAS,GAAGrC,MAAM,CAACoC,MAAM;UAC/B,MAAME,OAAO,GAAGD,SAAS,CAACE,SAAS,CAACF,SAAS,CAACG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;UAC/D,OAAO,IAAI,CAACpF,GAAG,CAACiB,MAAM,CAACiE,OAAO,EAAE;YAAChE,IAAI,EAAEd,QAAQ;YAAE4E,MAAM,EAAE;UAAI,CAAC,CAAC;QACjE;MACF;MACA,MAAM,IAAIK,KAAK,CAAC,mBAAmB,CAAC;IACtC,CAAC,CACH,CAAC;EACH;EAEArD,MAAMA,CAAA,EAAG;IACP,OAAO,IAAIxB,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAMiD,KAAK,GAAG;QACZC,UAAU,EAAE,IAAI,CAAC9E,WAAW,CAAC+E,MAAM,CAACC,OAAO;MAC7C,CAAC;MACD,MAAMX,KAAK,GAAG,IAAIzF,QAAQ,CAAC,CAAC;MAC5B,MAAMwF,GAAG,GAAGC,KAAK,CAACC,KAAK,CAACO,KAAK,CAAC;MAC9B,IAAI,CAAC1E,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAAkB,CAAC,CAAC;MAChDO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAQ,OAAOA,CAAA,EAAG;IACR,OAAO,IAAIzB,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAM6D,SAAS,GAAG,IAAIhH,SAAS,CAAC,CAAC;MACjC,MAAM2F,GAAG,GAAGqB,SAAS,CAACnB,KAAK,CAAC,IAAI,CAAC;MACjC,IAAI,CAACnE,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAAmB,CAAC,CAAC;MACjDO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAS,gBAAgBA,CAAA,EAAG;IACjB,IAAI,IAAI,CAAC1C,aAAa,CAAC+F,KAAK,EAAE;MAC5B,OAAO,IAAI/E,OAAO,CAACiB,OAAO,IAAI;QAC5B,MAAM+D,kBAAkB,GAAG,IAAI7G,kBAAkB,CAAC,CAAC;QACnD,MAAMsF,GAAG,GAAGuB,kBAAkB,CAACrB,KAAK,CAAC,IAAI,CAAC3E,aAAa,CAAC;QACxD,IAAI,CAACQ,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;UAAC/C,IAAI,EAAE;QAAuB,CAAC,CAAC;QACrDO,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;IACJ;IACA,OAAOjB,OAAO,CAACiB,OAAO,CAAC,CAAC;EAC1B;EAEAW,eAAeA,CAAA,EAAG;IAChB,IAAImD,KAAK,GAAG,CAAC;IACb,MAAME,aAAa,GAAG,CACpB;MAACrB,EAAE,QAAApB,MAAA,CAAQuC,KAAK,EAAE,CAAE;MAAElB,IAAI,EAAEnG,OAAO,CAACwH,MAAM;MAAEnB,MAAM,EAAE;IAAY,CAAC,EACjE;MAACH,EAAE,QAAApB,MAAA,CAAQuC,KAAK,EAAE,CAAE;MAAElB,IAAI,EAAEnG,OAAO,CAACyH,KAAK;MAAEpB,MAAM,EAAE;IAAkB,CAAC,CACvE;IACD,IAAI,IAAI,CAAC/E,aAAa,CAAC+F,KAAK,EAAE;MAC5BE,aAAa,CAACvC,IAAI,CAAC;QACjBkB,EAAE,QAAApB,MAAA,CAAQuC,KAAK,EAAE,CAAE;QACnBlB,IAAI,EAAEnG,OAAO,CAACE,aAAa;QAC3BmG,MAAM,EAAE;MACV,CAAC,CAAC;IACJ;IACA,IAAI,CAAC1E,WAAW,CAAC+F,OAAO,CAACrE,SAAS,IAAI;MACpC,IAAIA,SAAS,EAAE;QACbA,SAAS,CAACsE,GAAG,SAAA7C,MAAA,CAASuC,KAAK,EAAE,CAAE;QAC/BE,aAAa,CAACvC,IAAI,CAAC;UACjBkB,EAAE,EAAE7C,SAAS,CAACsE,GAAG;UACjBxB,IAAI,EAAEnG,OAAO,CAAC4H,SAAS;UACvBvB,MAAM,qBAAAvB,MAAA,CAAqBzB,SAAS,CAACoB,EAAE;QACzC,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;IACF,OAAO,IAAInC,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAMyC,KAAK,GAAG,IAAI3F,kBAAkB,CAAC,CAAC;MACtC,MAAM0F,GAAG,GAAGC,KAAK,CAACC,KAAK,CAACsB,aAAa,CAAC;MACtC,IAAI,CAACzF,GAAG,CAACiB,MAAM,CAACgD,GAAG,EAAE;QAAC/C,IAAI,EAAE;MAA6B,CAAC,CAAC;MAC3DO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAY,WAAWA,CAAA,EAAG;IACZ,MAAM;MAACrC;IAAG,CAAC,GAAG,IAAI;IAClB,MAAM0E,KAAK,GAAG;MACZC,UAAU,EAAE,IAAI,CAAC9E,WAAW,CAAC+E,MAAM,CAACC,OAAO,CAAC;MAC5CjE,YAAY,EAAE,IAAI,CAAChB,aAAa,CAAC8E,KAAK;MACtC5E,KAAK,EAAE,IAAI,CAACA,KAAK;MACjB2D,UAAU,EAAE,CAAC,CAAC;MACdsC,cAAc,EAAE,CAAC;IACnB,CAAC;IAED,OAAO,IAAIvF,OAAO,CAACiB,OAAO,IAAI;MAC5B,MAAMyC,KAAK,GAAG,IAAIxF,aAAa,CAAC,CAAC;MACjCwF,KAAK,CAAC8B,OAAO,CAACtB,KAAK,CAAC;MACpB1E,GAAG,CAACiB,MAAM,CAACiD,KAAK,CAACC,KAAK,CAACO,KAAK,CAAC,EAAE;QAACxD,IAAI,EAAE;MAAkB,CAAC,CAAC;MAC1DO,OAAO,CAAC,CAAC;IACX,CAAC,CAAC;EACJ;EAEAa,SAASA,CAAA,EAAG;IACV,OAAO,IAAI9B,OAAO,CAAC,CAACiB,OAAO,EAAEwE,MAAM,KAAK;MACtC,IAAI,CAAC9F,MAAM,CAACgB,EAAE,CAAC,OAAO,EAAE8E,MAAM,CAAC;MAC/B,IAAI,CAAC9F,MAAM,CAACgB,EAAE,CAAC,QAAQ,EAAE,MAAM;QAC7BM,OAAO,CAAC,IAAI,CAAC;MACf,CAAC,CAAC;MACF,IAAI,CAACzB,GAAG,CAACmB,EAAE,CAAC,OAAO,EAAE8E,MAAM,CAAC;MAE5B,IAAI,CAACjG,GAAG,CAACkG,QAAQ,CAAC,CAAC;IACrB,CAAC,CAAC;EACJ;AACF;AAEAC,MAAM,CAACC,OAAO,GAAGtH,cAAc","ignoreList":[]}