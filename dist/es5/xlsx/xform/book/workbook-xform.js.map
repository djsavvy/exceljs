{"version":3,"file":"workbook-xform.js","names":["_","require","colCache","XmlStream","BaseXform","StaticXform","ListXform","DefinedNameXform","SheetXform","WorkbookViewXform","WorkbookPropertiesXform","WorkbookCalcPropertiesXform","WorkbookPivotCacheXform","WorkbookXform","constructor","map","fileVersion","STATIC_XFORMS","workbookPr","bookViews","tag","count","childXform","sheets","definedNames","calcPr","pivotCaches","prepare","model","worksheets","printAreas","index","forEach","sheet","pageSetup","printArea","split","printAreaComponents","definedName","name","ranges","concat","localSheetId","push","printTitlesRow","printTitlesColumn","titlesColumns","titlesRows","length","media","medium","i","type","render","xmlStream","openXml","StdDocAttributes","openNode","WORKBOOK_ATTRIBUTES","properties","views","calcProperties","pivotTables","closeNode","parseOpen","node","parser","parseText","text","parseClose","undefined","reconcile","rels","workbookRels","reduce","rel","Id","worksheet","rId","worksheetHash","Target","replace","id","state","each","range","decodeEx","dimensions","rangeString","join","dollarRegex","rowRangeRegex","rowRangeMatches","match","columnRangeRegex","columnRangeMatches","xmlns","$","appName","lastEdited","lowestEdited","rupBuild","module","exports"],"sources":["../../../../../lib/xlsx/xform/book/workbook-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\r\n\r\nconst colCache = require('../../../utils/col-cache');\r\nconst XmlStream = require('../../../utils/xml-stream');\r\n\r\nconst BaseXform = require('../base-xform');\r\nconst StaticXform = require('../static-xform');\r\nconst ListXform = require('../list-xform');\r\nconst DefinedNameXform = require('./defined-name-xform');\r\nconst SheetXform = require('./sheet-xform');\r\nconst WorkbookViewXform = require('./workbook-view-xform');\r\nconst WorkbookPropertiesXform = require('./workbook-properties-xform');\r\nconst WorkbookCalcPropertiesXform = require('./workbook-calc-properties-xform');\r\nconst WorkbookPivotCacheXform = require('./workbook-pivot-cache-xform');\r\n\r\nclass WorkbookXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      fileVersion: WorkbookXform.STATIC_XFORMS.fileVersion,\r\n      workbookPr: new WorkbookPropertiesXform(),\r\n      bookViews: new ListXform({\r\n        tag: 'bookViews',\r\n        count: false,\r\n        childXform: new WorkbookViewXform(),\r\n      }),\r\n      sheets: new ListXform({tag: 'sheets', count: false, childXform: new SheetXform()}),\r\n      definedNames: new ListXform({\r\n        tag: 'definedNames',\r\n        count: false,\r\n        childXform: new DefinedNameXform(),\r\n      }),\r\n      calcPr: new WorkbookCalcPropertiesXform(),\r\n      pivotCaches: new ListXform({\r\n        tag: 'pivotCaches',\r\n        count: false,\r\n        childXform: new WorkbookPivotCacheXform(),\r\n      }),\r\n    };\r\n  }\r\n\r\n  prepare(model) {\r\n    model.sheets = model.worksheets;\r\n\r\n    // collate all the print areas from all of the sheets and add them to the defined names\r\n    const printAreas = [];\r\n    let index = 0; // sheets is sparse array - calc index manually\r\n    model.sheets.forEach(sheet => {\r\n      if (sheet.pageSetup && sheet.pageSetup.printArea) {\r\n        sheet.pageSetup.printArea.split('&&').forEach(printArea => {\r\n          const printAreaComponents = printArea.split(':');\r\n          const definedName = {\r\n            name: '_xlnm.Print_Area',\r\n            ranges: [`'${sheet.name}'!$${printAreaComponents[0]}:$${printAreaComponents[1]}`],\r\n            localSheetId: index,\r\n          };\r\n          printAreas.push(definedName);\r\n        });\r\n      }\r\n\r\n      if (sheet.pageSetup && (sheet.pageSetup.printTitlesRow || sheet.pageSetup.printTitlesColumn)) {\r\n        const ranges = [];\r\n\r\n        if (sheet.pageSetup.printTitlesColumn) {\r\n          const titlesColumns = sheet.pageSetup.printTitlesColumn.split(':');\r\n          ranges.push(`'${sheet.name}'!$${titlesColumns[0]}:$${titlesColumns[1]}`);\r\n        }\r\n\r\n        if (sheet.pageSetup.printTitlesRow) {\r\n          const titlesRows = sheet.pageSetup.printTitlesRow.split(':');\r\n          ranges.push(`'${sheet.name}'!$${titlesRows[0]}:$${titlesRows[1]}`);\r\n        }\r\n\r\n        const definedName = {\r\n          name: '_xlnm.Print_Titles',\r\n          ranges,\r\n          localSheetId: index,\r\n        };\r\n\r\n        printAreas.push(definedName);\r\n      }\r\n      index++;\r\n    });\r\n    if (printAreas.length) {\r\n      model.definedNames = model.definedNames.concat(printAreas);\r\n    }\r\n\r\n    (model.media || []).forEach((medium, i) => {\r\n      // assign name\r\n      medium.name = medium.type + (i + 1);\r\n    });\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n    xmlStream.openNode('workbook', WorkbookXform.WORKBOOK_ATTRIBUTES);\r\n\r\n    this.map.fileVersion.render(xmlStream);\r\n    this.map.workbookPr.render(xmlStream, model.properties);\r\n    this.map.bookViews.render(xmlStream, model.views);\r\n    this.map.sheets.render(xmlStream, model.sheets);\r\n    this.map.definedNames.render(xmlStream, model.definedNames);\r\n    this.map.calcPr.render(xmlStream, model.calcProperties);\r\n    this.map.pivotCaches.render(xmlStream, model.pivotTables);\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'workbook':\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n        }\r\n        return true;\r\n    }\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'workbook':\r\n        this.model = {\r\n          sheets: this.map.sheets.model,\r\n          properties: this.map.workbookPr.model || {},\r\n          views: this.map.bookViews.model,\r\n          calcProperties: {},\r\n        };\r\n        if (this.map.definedNames.model) {\r\n          this.model.definedNames = this.map.definedNames.model;\r\n        }\r\n\r\n        return false;\r\n      default:\r\n        // not quite sure how we get here!\r\n        return true;\r\n    }\r\n  }\r\n\r\n  reconcile(model) {\r\n    const rels = (model.workbookRels || []).reduce((map, rel) => {\r\n      map[rel.Id] = rel;\r\n      return map;\r\n    }, {});\r\n\r\n    // reconcile sheet ids, rIds and names\r\n    const worksheets = [];\r\n    let worksheet;\r\n    let index = 0;\r\n\r\n    (model.sheets || []).forEach(sheet => {\r\n      const rel = rels[sheet.rId];\r\n      if (!rel) {\r\n        return;\r\n      }\r\n      // if rel.Target start with `[space]/xl/` or `/xl/` , then it will be replaced with `''` and spliced behind `xl/`,\r\n      // otherwise it will be spliced directly behind `xl/`. i.g.\r\n      worksheet = model.worksheetHash[`xl/${rel.Target.replace(/^(\\s|\\/xl\\/)+/, '')}`];\r\n      // If there are \"chartsheets\" in the file, rel.Target will\r\n      // come out as chartsheets/sheet1.xml or similar here, and\r\n      // that won't be in model.worksheetHash.\r\n      // As we don't have the infrastructure to support chartsheets,\r\n      // we will ignore them for now:\r\n      if (worksheet) {\r\n        worksheet.name = sheet.name;\r\n        worksheet.id = sheet.id;\r\n        worksheet.state = sheet.state;\r\n        worksheets[index++] = worksheet;\r\n      }\r\n    });\r\n\r\n    // reconcile print areas\r\n    const definedNames = [];\r\n    _.each(model.definedNames, definedName => {\r\n      if (definedName.name === '_xlnm.Print_Area') {\r\n        worksheet = worksheets[definedName.localSheetId];\r\n        if (worksheet) {\r\n          if (!worksheet.pageSetup) {\r\n            worksheet.pageSetup = {};\r\n          }\r\n          const range = colCache.decodeEx(definedName.ranges[0]);\r\n          worksheet.pageSetup.printArea = worksheet.pageSetup.printArea\r\n            ? `${worksheet.pageSetup.printArea}&&${range.dimensions}`\r\n            : range.dimensions;\r\n        }\r\n      } else if (definedName.name === '_xlnm.Print_Titles') {\r\n        worksheet = worksheets[definedName.localSheetId];\r\n        if (worksheet) {\r\n          if (!worksheet.pageSetup) {\r\n            worksheet.pageSetup = {};\r\n          }\r\n\r\n          const rangeString = definedName.ranges.join(',');\r\n\r\n          const dollarRegex = /\\$/g;\r\n\r\n          const rowRangeRegex = /\\$\\d+:\\$\\d+/;\r\n          const rowRangeMatches = rangeString.match(rowRangeRegex);\r\n\r\n          if (rowRangeMatches && rowRangeMatches.length) {\r\n            const range = rowRangeMatches[0];\r\n            worksheet.pageSetup.printTitlesRow = range.replace(dollarRegex, '');\r\n          }\r\n\r\n          const columnRangeRegex = /\\$[A-Z]+:\\$[A-Z]+/;\r\n          const columnRangeMatches = rangeString.match(columnRangeRegex);\r\n\r\n          if (columnRangeMatches && columnRangeMatches.length) {\r\n            const range = columnRangeMatches[0];\r\n            worksheet.pageSetup.printTitlesColumn = range.replace(dollarRegex, '');\r\n          }\r\n        }\r\n      } else {\r\n        definedNames.push(definedName);\r\n      }\r\n    });\r\n    model.definedNames = definedNames;\r\n\r\n    // used by sheets to build their image models\r\n    model.media.forEach((media, i) => {\r\n      media.index = i;\r\n    });\r\n  }\r\n}\r\n\r\nWorkbookXform.WORKBOOK_ATTRIBUTES = {\r\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n  'mc:Ignorable': 'x15',\r\n  'xmlns:x15': 'http://schemas.microsoft.com/office/spreadsheetml/2010/11/main',\r\n};\r\nWorkbookXform.STATIC_XFORMS = {\r\n  fileVersion: new StaticXform({\r\n    tag: 'fileVersion',\r\n    $: {appName: 'xl', lastEdited: 5, lowestEdited: 5, rupBuild: 9303},\r\n  }),\r\n};\r\n\r\nmodule.exports = WorkbookXform;\r\n"],"mappings":"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","ignoreList":[]}